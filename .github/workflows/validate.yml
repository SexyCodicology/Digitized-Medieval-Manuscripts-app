# Data Validation Workflow
#
# Validates docs/assets/data.json on every pull request that touches it,
# and on manual dispatch. Checks JSON syntax, schema compliance, data types,
# URI formats, and conditional project-field requirements.

name: Data Guardrails

on:
  pull_request:
    paths:
      - 'docs/assets/data.json'
  workflow_dispatch:

jobs:
  validate-data:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v6

      - name: Setup Node.js
        uses: actions/setup-node@v6
        with:
          node-version: '16'

      - name: Install Validator & Formats
        run: npm install -g ajv-cli ajv-formats

      - name: Validate JSON Syntax & Schema
        run: |
          # Check 1: well-formed JSON
          python3 -m json.tool docs/assets/data.json > /dev/null
          echo "✓ JSON syntax valid"

          # Check 2: schema compliance (required fields, types, URIs,
          # conditional project fields)
          ajv validate -s schema.json -d docs/assets/data.json -c ajv-formats
          echo "✓ Schema validation passed"
